<!DOCTYPE html>
<html>
<head>
    <title>Guestbook Authorization Rules</title>
    <script type="module" src="https://jamesaduncan.github.io/dom-aware-primitives/index.mjs"></script>
</head>
<body>
    <h1>Guestbook Authorization Configuration</h1>
    
    <!-- User definitions -->
    <table id="users">
        <caption>Users & Roles</caption>
        <thead>
            <tr>
                <th>Username</th>
                <th>Roles</th>
            </tr>
        </thead>
        <tbody>
            <tr itemscope itemtype="http://rustybeam.net/User">
                <td itemprop="username">test@example.com</td>
                <td>
                    <ul>
                        <li itemprop="role">administrators</li>
                        <li itemprop="role">user</li>
                    </ul>
                </td>
            </tr>
            <tr itemscope itemtype="http://rustybeam.net/User">
                <td itemprop="username">james@kinburnstreet.consulting</td>
                <td>
                    <ul>
                        <li itemprop="role">user</li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Google OAuth2 Users Note -->
    <div style="background: #e3f2fd; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <h3>Note on Google OAuth2 Users</h3>
        <p>Users who authenticate via Google OAuth2 are automatically granted the 'user' role.</p>
        <p>The OAuth2 plugin sets the 'authenticated_user' metadata with the user's email address.</p>
        <p>Administrators can be designated by adding their Google email to the administrators role.</p>
    </div>

    <!-- Authorization rules -->
    <table id="authorization">
        <caption>Authorization Rules</caption>
        <thead>
            <tr>
                <th>Username/Role</th>
                <th>Path</th>
                <th>Selector</th>
                <th>Method</th>
                <th>Action</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <!-- Allow everyone to read the guestbook -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/*</td>
                <td></td>
                <td>
                    <ul>
                        <li itemprop="method">GET</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Everyone can read all pages</td>
            </tr>
            
            <!-- Allow everyone to read entries specifically -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/</td>
                <td itemprop="selector">#entries</td>
                <td>
                    <ul>
                        <li itemprop="method">GET</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Everyone can read guestbook entries</td>
            </tr>
            
            <!-- Allow everyone to add entries (POST to #entries) -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/</td>
                <td itemprop="selector">#entries</td>
                <td>
                    <ul>
                        <li itemprop="method">POST</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Everyone can add new guestbook entries</td>
            </tr>
            
            <!-- Deny deletion of entries by default -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/</td>
                <td itemprop="selector">#entries .entry</td>
                <td>
                    <ul>
                        <li itemprop="method">DELETE</li>
                    </ul>
                </td>
                <td itemprop="action">deny</td>
                <td>Regular users cannot delete entries</td>
            </tr>
            
            <!-- Allow administrators to delete individual entries -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="role">administrators</td>
                <td itemprop="path">/</td>
                <td itemprop="selector">#entries .entry</td>
                <td>
                    <ul>
                        <li itemprop="method">DELETE</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Administrators can delete individual entries</td>
            </tr>
            
            
            <!-- Deny all other modifications by default -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/*</td>
                <td></td>
                <td>
                    <ul>
                        <li itemprop="method">PUT</li>
                        <li itemprop="method">POST</li>
                        <li itemprop="method">DELETE</li>
                    </ul>
                </td>
                <td itemprop="action">deny</td>
                <td>Deny all other write operations by default</td>
            </tr>
            
            <!-- Allow WebSocket connections -->
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">*</td>
                <td itemprop="path">/ws</td>
                <td></td>
                <td>
                    <ul>
                        <li itemprop="method">GET</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Everyone can connect to WebSocket</td>
            </tr>
            
            <!-- Example: Allow specific Google user admin privileges -->
            <!-- Uncomment and update email to grant admin access to a Google user -->
            <!--
            <tr itemscope itemtype="http://rustybeam.net/AuthorizationRule">
                <td itemprop="username">admin@example.com</td>
                <td itemprop="path">/</td>
                <td itemprop="selector">#entries .entry</td>
                <td>
                    <ul>
                        <li itemprop="method">DELETE</li>
                    </ul>
                </td>
                <td itemprop="action">allow</td>
                <td>Specific Google user has admin privileges</td>
            </tr>
            -->
        </tbody>
    </table>
    
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        td, th { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        caption { font-weight: bold; margin-bottom: 10px; }
        ul { margin: 0; padding-left: 20px; }
    </style>
</body>
</html>