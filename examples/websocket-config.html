<!DOCTYPE html>
<html>
<head>
    <title>Rusty Beam Configuration with WebSocket Support</title>
</head>
<body>
    <h1>Server Configuration with WebSocket Plugin</h1>
    
    <!-- Server Configuration -->
    <table itemscope itemtype="http://rustybeam.net/ServerConfig">
        <tbody>
            <tr>
                <td>Server Root</td>
                <td itemprop="serverRoot">./examples/files</td>
            </tr>
            <tr>
                <td>Bind Address</td>
                <td itemprop="bindAddress">127.0.0.1</td>
            </tr>
            <tr>
                <td>Bind Port</td>
                <td itemprop="bindPort">3000</td>
            </tr>
        </tbody>
    </table>

    <h2>Host Configuration</h2>
    
    <!-- Localhost with WebSocket support -->
    <table itemscope itemtype="http://rustybeam.net/HostConfig">
        <tbody>
            <tr>
                <td>Host Name</td>
                <td itemprop="hostName">localhost</td>
            </tr>
            <tr>
                <td>Host Root</td>
                <td itemprop="hostRoot">./examples/localhost</td>
            </tr>
            <tr>
                <td>Plugins</td>
                <td>
                    <ol itemprop="plugins">
                        <!-- Access logging -->
                        <li>
                            <table itemscope itemtype="http://rustybeam.net/Plugin">
                                <tbody>
                                    <tr>
                                        <td>Library</td>
                                        <td itemprop="library">file://./plugins/librusty_beam_access_log.so</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        
                        <!-- WebSocket support - must come before file-handler -->
                        <li>
                            <table itemscope itemtype="http://rustybeam.net/Plugin">
                                <tbody>
                                    <tr>
                                        <td>Library</td>
                                        <td itemprop="library">file://./plugins/librusty_beam_websocket.so</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        
                        <!-- Selector handler for content manipulation -->
                        <li>
                            <table itemscope itemtype="http://rustybeam.net/Plugin">
                                <tbody>
                                    <tr>
                                        <td>Library</td>
                                        <td itemprop="library">file://./plugins/librusty_beam_selector_handler.so</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        
                        <!-- File handler -->
                        <li>
                            <table itemscope itemtype="http://rustybeam.net/Plugin">
                                <tbody>
                                    <tr>
                                        <td>Library</td>
                                        <td itemprop="library">file://./plugins/librusty_beam_file_handler.so</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                    </ol>
                </td>
            </tr>
        </tbody>
    </table>

    <h2>Example Usage</h2>
    
    <p>With this configuration:</p>
    <ol>
        <li>Start the server: <code>./rusty-beam examples/websocket-config.html</code></li>
        <li>Connect via WebSocket: <code>ws://localhost:3000/document.html</code></li>
        <li>Subscribe to changes using the das-ws.js protocol</li>
        <li>Modify content using selector-handler and see real-time updates</li>
    </ol>

    <h2>Testing WebSocket</h2>
    
    <pre><code># Test WebSocket upgrade
wscat -c ws://localhost:3000/test.html

# In wscat, subscribe to changes:
{"action": "subscribe", "selector": "#content", "url": "/test.html"}

# In another terminal, update content:
curl -X PUT -H 'Range: selector=#content' \
  -d '&lt;div id="content"&gt;Real-time update!&lt;/div&gt;' \
  http://localhost:3000/test.html

# The wscat terminal will receive the StreamItem update</code></pre>
</body>
</html>