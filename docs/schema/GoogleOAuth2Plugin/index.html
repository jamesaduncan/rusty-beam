<!DOCTYPE html>
<html>
<head>
    <title>GoogleOAuth2Plugin Schema - Rusty Beam</title>
    <style>
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: #333; }
        code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f8f8f8; font-weight: bold; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .info { background: #e3f2fd; border: 1px solid #bbdefb; padding: 15px; border-radius: 5px; margin: 20px 0; }
        nav { margin-bottom: 20px; }
        nav a { margin-right: 10px; }
    </style>
</head>
<body itemscope itemtype="http://rustybeam.net/schema/Schema">
    <nav>
        <a href="/">Home</a> → 
        <a href="/schema/">Schemas</a> → 
        <a href="/schema/AuthPlugin/">AuthPlugin</a> → 
        GoogleOAuth2Plugin
    </nav>
    
    <h1>GoogleOAuth2Plugin Schema</h1>
    
    <p>The GoogleOAuth2Plugin schema defines the configuration for Google OAuth2 authentication in Rusty Beam. This plugin enables users to authenticate using their Google accounts and sets the <code>authenticated_user</code> metadata for other plugins to use.</p>
    
    <div class="info">
        <strong>Security Note:</strong> Client ID and secret are read from environment variables <code>GOOGLE_CLIENT_ID</code> and <code>GOOGLE_CLIENT_SECRET</code> for security. These are not part of the configuration schema.
    </div>

    <h2>Schema Definition</h2>
    
    <p>Schema URL: <code>http://rustybeam.net/GoogleOAuth2Plugin</code></p>
    <p>Parent Schema: <span itemprop="parent">http://rustybeam.net/AuthPlugin</span></p>
    
    <h2>Properties</h2>

    <div class="info">
        <strong>Inheritance:</strong> This schema inherits properties from <a href="/schema/AuthPlugin/">AuthPlugin</a> (authfile, realm) and <a href="/schema/Plugin/">Plugin</a> (library, plugin).
    </div>

    <table>
        <thead>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Cardinality</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr itemscope itemtype="http://rustybeam.net/schema/Property">
                <td><span itemprop="name">redirect_uri</span></td>
                <td><span itemprop="type">URL</span></td>
                <td><span itemprop="cardinality">0..1</span></td>
                <td><span itemprop="description">OAuth2 callback URL (must match Google Cloud Console configuration). Defaults to http://localhost:3000/auth/google/callback</span></td>
            </tr>
            <tr itemscope itemtype="http://rustybeam.net/schema/Property">
                <td><span itemprop="name">name</span></td>
                <td><span itemprop="type">Text</span></td>
                <td><span itemprop="cardinality">0..1</span></td>
                <td><span itemprop="description">Plugin instance name for identification. Defaults to "google-oauth2" if not specified.</span></td>
            </tr>
        </tbody>
    </table>

    <h2>Configuration Example</h2>

    <pre><code>&lt;!-- Plugin configuration (secrets come from environment variables) --&gt;
&lt;td itemprop="plugin" itemscope itemtype="http://rustybeam.net/GoogleOAuth2Plugin"&gt;
    &lt;span itemprop="library"&gt;file://./plugins/librusty_beam_google_oauth2.so&lt;/span&gt;
    &lt;span itemprop="redirect_uri"&gt;http://localhost:3000/auth/google/callback&lt;/span&gt;
&lt;/td&gt;</code></pre>

    <h2>Environment Variables</h2>
    
    <p>The following environment variables must be set for the plugin to work:</p>
    
    <table>
        <thead>
            <tr>
                <th>Variable</th>
                <th>Required</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>GOOGLE_CLIENT_ID</code></td>
                <td>Yes</td>
                <td>Google OAuth2 client ID from Google Cloud Console</td>
                <td><code>123456789.apps.googleusercontent.com</code></td>
            </tr>
            <tr>
                <td><code>GOOGLE_CLIENT_SECRET</code></td>
                <td>Yes</td>
                <td>Google OAuth2 client secret from Google Cloud Console</td>
                <td><code>GOCSPX-xxxxxxxxxxxxxxxxxxxx</code></td>
            </tr>
        </tbody>
    </table>
    
    <div class="warning">
        <strong>Security:</strong> These credentials are sensitive and should be kept secure. Use environment variables or a secrets management system - never commit them to version control.
    </div>

    <h2>Setup Requirements</h2>

    <div class="warning">
        <strong>Google Cloud Console Setup Required:</strong>
        <ol>
            <li>Create a project at <a href="https://console.cloud.google.com/">Google Cloud Console</a></li>
            <li>Enable the Google+ API</li>
            <li>Create OAuth2 credentials (Web application type)</li>
            <li>Add your redirect URI to Authorized redirect URIs</li>
            <li>Set environment variables <code>GOOGLE_CLIENT_ID</code> and <code>GOOGLE_CLIENT_SECRET</code></li>
        </ol>
    </div>

    <h2>Endpoints</h2>

    <p>This plugin automatically provides these endpoints:</p>
    <ul>
        <li><code>/auth/google/login</code> - Initiates Google OAuth2 flow</li>
        <li><code>/auth/google/callback</code> - Handles OAuth2 callback</li>
        <li><code>/auth/logout</code> - Clears authentication session</li>
        <li><code>/auth/status</code> - Returns current authentication status</li>
    </ul>

    <h2>Integration</h2>

    <h3>With Authorization Plugin</h3>
    <p>Users authenticated via Google OAuth2 are automatically granted the 'user' role. Administrators can be designated by adding their Google email to the administrators role in the authorization plugin configuration.</p>

    <h3>Metadata Set</h3>
    <p>The plugin sets the following metadata for other plugins to use:</p>
    <ul>
        <li><code>authenticated_user</code> - User's email address</li>
        <li><code>user_name</code> - User's display name</li>
    </ul>

    <h2>Security Considerations</h2>

    <div class="warning">
        <strong>Security Best Practices:</strong>
        <ul>
            <li>Use environment variables for credentials - never store them in configuration files</li>
            <li>Keep <code>GOOGLE_CLIENT_SECRET</code> confidential and never commit to version control</li>
            <li>Use HTTPS in production for all OAuth2 URLs</li>
            <li>Regularly rotate OAuth2 credentials</li>
            <li>Restrict authorized redirect URIs to only necessary domains</li>
            <li>Use a <code>.env</code> file for local development (excluded from version control)</li>
        </ul>
    </div>

    <h2>See Also</h2>
    
    <ul>
        <li><a href="/schema/AuthPlugin/">AuthPlugin</a> - Parent schema</li>
        <li><a href="/schema/AuthorizationPlugin/">AuthorizationPlugin</a> - Role-based access control</li>
        <li><a href="/plugins/google-oauth2/">Google OAuth2 Plugin Documentation</a></li>
        <li><a href="https://developers.google.com/identity/protocols/oauth2">Google OAuth2 Documentation</a></li>
    </ul>
    
    <footer>
    </footer>
</body>
</html>