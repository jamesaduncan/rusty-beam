<!DOCTYPE html>
<html>
<head>
    <title>StreamItem Schema - Rusty Beam</title>
    <style>
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: #333; }
        code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f8f8f8; font-weight: bold; }
        nav { margin-bottom: 20px; }
        nav a { margin-right: 10px; }
    </style>
</head>
<body itemscope itemtype="http://rustybeam.net/StreamItem">
    <nav>
        <a href="/">Home</a> → 
        <a href="/docs/">Documentation</a> → 
        <a href="/docs/schemas/">Schemas</a> → 
        StreamItem
    </nav>

    <h1>StreamItem Schema</h1>
    
    <p>The StreamItem schema represents a real-time update notification for document changes in Rusty Beam. It is used by the WebSocket plugin to broadcast changes to subscribed clients.</p>

    <h2>Schema Definition</h2>
    
    <p>Schema URL: <code>http://rustybeam.net/StreamItem</code></p>

    <h2>Properties</h2>

    <table>
        <thead>
            <tr>
                <th>Property</th>
                <th>Type</th>
                <th>Cardinality</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr itemscope itemtype="http://rustybeam.net/Property">
                <td itemprop="name">method</td>
                <td itemprop="type">Text</td>
                <td itemprop="cardinality">1</td>
                <td itemprop="description">The HTTP method that triggered the update (PUT, POST, or DELETE)</td>
            </tr>
            <tr itemscope itemtype="http://rustybeam.net/Property">
                <td itemprop="name">url</td>
                <td itemprop="type">URL</td>
                <td itemprop="cardinality">1</td>
                <td itemprop="description">The URL of the document that was modified</td>
            </tr>
            <tr itemscope itemtype="http://rustybeam.net/Property">
                <td itemprop="name">selector</td>
                <td itemprop="type">Text</td>
                <td itemprop="cardinality">1</td>
                <td itemprop="description">The CSS selector that was used to target the content</td>
            </tr>
            <tr itemscope itemtype="http://rustybeam.net/Property">
                <td itemprop="name">content</td>
                <td itemprop="type">HTML</td>
                <td itemprop="cardinality">1</td>
                <td itemprop="description">The updated HTML content after the modification</td>
            </tr>
        </tbody>
    </table>

    <h2>Example</h2>

    <pre><code>&lt;div itemscope itemtype="http://rustybeam.net/StreamItem"&gt;
    &lt;span itemprop="method"&gt;PUT&lt;/span&gt;
    &lt;span itemprop="url"&gt;/blog/article.html&lt;/span&gt;
    &lt;span itemprop="selector"&gt;#main-content&lt;/span&gt;
    &lt;div itemprop="content"&gt;
        &lt;article id="main-content"&gt;
            &lt;h2&gt;Updated Article Title&lt;/h2&gt;
            &lt;p&gt;This content was just updated...&lt;/p&gt;
        &lt;/article&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>

    <h2>Usage Context</h2>

    <h3>WebSocket Broadcasting</h3>
    <p>StreamItem is primarily used by the WebSocket plugin to notify connected clients about document changes. When a document is modified using the selector-handler plugin, a StreamItem is broadcast to all clients subscribed to the matching selector.</p>

    <h3>Method Values</h3>
    <ul>
        <li><code>PUT</code> - Content was replaced</li>
        <li><code>POST</code> - Content was appended</li>
        <li><code>DELETE</code> - Content was removed</li>
    </ul>

    <h3>Content Property</h3>
    <p>The <code>content</code> property contains the actual HTML after the modification:</p>
    <ul>
        <li>For PUT: The new content that replaced the selected element</li>
        <li>For POST: The updated element including the appended content</li>
        <li>For DELETE: The content that was removed (before deletion)</li>
    </ul>

    <h2>Client Processing</h2>

    <p>JavaScript example for processing StreamItem:</p>
    
    <pre><code>ws.onmessage = (event) => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(event.data, 'text/html');
    
    // Check if it's a StreamItem
    const streamItem = doc.querySelector('[itemtype="http://rustybeam.net/StreamItem"]');
    if (streamItem) {
        const method = streamItem.querySelector('[itemprop="method"]')?.textContent;
        const url = streamItem.querySelector('[itemprop="url"]')?.textContent;
        const selector = streamItem.querySelector('[itemprop="selector"]')?.textContent;
        const content = streamItem.querySelector('[itemprop="content"]')?.innerHTML;
        
        console.log(`${method} ${url} ${selector}`, content);
        
        // Update local DOM if needed
        if (selector && content) {
            document.querySelector(selector)?.outerHTML = content;
        }
    }
};</code></pre>

    <h2>Related Schemas</h2>

    <ul>
        <li><a href="/docs/plugins/websocket/">WebSocket Plugin</a> - Uses StreamItem for broadcasting</li>
        <li><a href="/docs/plugins/selector-handler/">Selector-Handler Plugin</a> - Triggers StreamItem creation</li>
    </ul>

    <footer>
        <p>© 2024 Rusty Beam Project</p>
    </footer>
</body>
</html>